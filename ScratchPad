let
    Source = AzureDataExplorer.Contents("
https://ade.loganalytics.io/subscriptions/58cb357e-51af-4f62-8982-a8c2b9059362/resourcegroups/rg-eus-desktopmanagement-nerdio-weu-prd/providers/microsoft.operationalinsights/workspaces/nmw-app-law-fwjv4wn75m4qg"
, "nmw-app-law-fwjv4wn75m4qg", "let binSize = 1m; #(lf)let timeRangeStart = now(-30d);#(lf)let timeRangeEnd = now();#(lf)let filterSubstring = ""ALL""; #(lf)Perf#(lf)| where TimeGenerated between (timeRangeStart..timeRangeEnd)#(lf)| where ObjectName == ""Processor Information"" and CounterName == ""% Processor Time""#(lf)| where filterSubstring == ""ALL"" or tostring(Computer) contains filterSubstring#(lf)| summarize #(lf)    AVG_CPU_Utilization_per = round(avg(CounterValue), 2),#(lf)    MAX_CPU_Utilization_per = round(max(CounterValue), 2),#(lf)    MIN_CPU_Utilization_per = round(min(CounterValue), 2),#(lf)    MED_CPU_Utilization_per = round(percentile(CounterValue, 50), 2),#(lf)    ItemsPerTimeBin_int = count() #(lf)  by BinnedTime = bin(TimeGenerated, binSize), Computer, Date = format_datetime(TimeGenerated, 'yyyy-MM-dd')#(lf)| extend Time = format_datetime(BinnedTime, 'HH:mm')#(lf)| extend TimeKey = replace("":"", """", Time)#(lf)| where MAX_CPU_Utilization_per >= 70 #(lf)| project Date, Time, TimeKey, Computer, AVG_CPU_Utilization_per, MED_CPU_Utilization_per, MAX_CPU_Utilization_per, MIN_CPU_Utilization_per, ItemsPerTimeBin_int", [MaxRows=null, MaxSize=null, NoTruncate=null, AdditionalSetStatements=null])
in
    Source
