let
    Source = AzureDataExplorer.Contents("https://ade.loganalytics.io/subscriptions/58cb357e-51af-4f62-8982-a8c2b9059362/resourcegroups/rg-eus-desktopmanagement-nerdio-weu-prd/providers/microsoft.operationalinsights/workspaces/nmw-app-law-fwjv4wn75m4qg", "nmw-app-law-fwjv4wn75m4qg", "WVDConnections#(lf)| where TimeGenerated >= ago(30d)#(lf)| extend UserName = trim("" "", tolower(UserName))#(lf)| where State == ""Connected""#(lf)| project CorrelationId, UserName, ResourceAlias, StartDate = TimeGenerated#(lf)| join (#(lf)    WVDConnections#(lf)    | where State == ""Completed""#(lf)    | project EndDate = TimeGenerated, CorrelationId#(lf)) on CorrelationId#(lf)| extend StartTimekey = format_datetime(StartDate, 'HHmm')#(lf)| extend EndTimekey = format_datetime(EndDate, 'HHmm')#(lf)| project CorrelationId, StartDate,StartTimekey, EndDate, EndTimekey, UserName, DurationSeconds = (EndDate - StartDate) / 1s#(lf)| summarize arg_max(StartDate, *) by CorrelationId", [MaxRows=null, MaxSize=null, NoTruncate=null, AdditionalSetStatements=null]),
    #"Changed Type2" = Table.TransformColumnTypes(Source,{{"DurationSeconds", type number}}),
    #"Rounded Off" = Table.TransformColumns(#"Changed Type2",{{"DurationSeconds", each Number.Round(_, 2), type number}}),
    #"Duplicated Column" = Table.DuplicateColumn(#"Rounded Off", "StartDate", "StartDate - Copy"),
    #"Changed Type" = Table.TransformColumnTypes(#"Duplicated Column",{{"StartDate - Copy", type text}}),
    #"Extracted Text After Delimiter" = Table.TransformColumns(#"Changed Type", {{"StartDate - Copy", each Text.AfterDelimiter(_, "T"), type text}}),
    #"Extracted First Characters" = Table.TransformColumns(#"Extracted Text After Delimiter", {{"StartDate - Copy", each Text.Start(_, 16), type text}}),
    #"Changed Type1" = Table.TransformColumnTypes(#"Extracted First Characters",{{"StartDate - Copy", type time}}),
    #"Renamed Columns" = Table.RenameColumns(#"Changed Type1",{{"StartDate - Copy", "StartTime"}}),
    #"Duplicated Column1" = Table.DuplicateColumn(#"Renamed Columns", "EndDate", "EndDate - Copy"),
    #"Changed Type3" = Table.TransformColumnTypes(#"Duplicated Column1",{{"EndDate - Copy", type text}}),
    #"Extracted Text After Delimiter1" = Table.TransformColumns(#"Changed Type3", {{"EndDate - Copy", each Text.AfterDelimiter(_, " "), type text}}),
    #"Extracted Text Before Delimiter" = Table.TransformColumns(#"Extracted Text After Delimiter1", {{"EndDate - Copy", each Text.BeforeDelimiter(_, " ", {0, RelativePosition.FromEnd}), type text}}),
    #"Renamed Columns1" = Table.RenameColumns(#"Extracted Text Before Delimiter",{{"EndDate - Copy", "EndTime"}}),
    #"Changed Type4" = Table.TransformColumnTypes(#"Renamed Columns1",{{"EndTime", type time}}),
    #"Reordered Columns" = Table.ReorderColumns(#"Changed Type4",{"CorrelationId", "StartDate", "StartTime", "StartTimekey", "EndDate", "EndTime", "EndTimekey", "UserName", "DurationSeconds"}),
    #"Duplicated Column2" = Table.DuplicateColumn(#"Reordered Columns", "StartDate", "StartDate - Copy"),
    #"Duplicated Column3" = Table.DuplicateColumn(#"Duplicated Column2", "EndDate", "EndDate - Copy"),
    #"Changed Type5" = Table.TransformColumnTypes(#"Duplicated Column3",{{"StartDate - Copy", type date}, {"EndDate - Copy", type date}}),
    #"Renamed Columns2" = Table.RenameColumns(#"Changed Type5",{{"StartDate - Copy", "StartDate - Short"}, {"EndDate - Copy", "EndDate - Short"}})
in
    #"Renamed Columns2"
