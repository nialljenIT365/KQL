let
    Source = AzureDataExplorer.Contents(LAWClusterURLAVD, LAWNameAVD, "WVDConnectionNetworkData#(lf)| join kind=inner (#(lf)    WVDErrors#(lf)) on CorrelationId#(lf)| where Type1 == ""WVDErrors""#(lf)| where TimeGenerated >= ago(30d)#(lf)| extend Date = format_datetime(TimeGenerated, 'yyyy-MM-dd')#(lf)| extend Time = format_datetime(TimeGenerated, 'HH:mm')#(lf)| extend TimeKey = replace("":"", """", Time)#(lf)| project TimeGenerated, Date, Time, TimeKey, CorrelationId, EstRoundTripTimeInMs, EstAvailableBandwidthKBps, UserName, Source, Code, CodeSymbolic, Message, Operation", [MaxRows=null, MaxSize=null, NoTruncate=null, AdditionalSetStatements=null])
in
    Source


let
    // Source query from Azure Data Explorer
    Source = AzureDataExplorer.Contents(
        LAWClusterURLAVD, 
        LAWNameAVD, 
        "WVDConnectionNetworkData" &
        "#(lf)| join kind=inner (" &
        "#(lf)    WVDErrors" &
        "#(lf)) on CorrelationId" &
        "#(lf)| where Type1 == ""WVDErrors""" &
        "#(lf)| where TimeGenerated >= ago(30d)" &
        "#(lf)| extend Date = format_datetime(TimeGenerated, 'yyyy-MM-dd')" &  // Adds Date column
        "#(lf)| extend Time = format_datetime(TimeGenerated, 'HH:mm')" &        // Adds Time column
        "#(lf)| extend TimeKey = replace("":"", """", Time)" &                  // Removes colons from Time
        "#(lf)| project TimeGenerated, Date, Time, TimeKey, CorrelationId, EstRoundTripTimeInMs, EstAvailableBandwidthKBps, UserName, Source, Code, CodeSymbolic, Message, Operation", 
        [MaxRows=null, MaxSize=null, NoTruncate=null, AdditionalSetStatements=null]
    )
in
    Source
