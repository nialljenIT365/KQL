$ResourceGroupName = "rg-EUS-RemoteDesktopDevices-PersistentVirtualDesktop-NEU-PRD"
$VMName = "M01PSSPI0001"

$hibernationStatus = (Get-AzVM -ResourceGroupName $ResourceGroupName -Name $VMName).HibernationEnabled

if ($hibernationStatus -eq $True) {
    Write-Output "Hibernation is enabled on VM: $VMName"
} elseif ($hibernationStatus -eq $False) {
    Write-Output "Hibernation is not enabled on VM: $VMName"
} else {
    Write-Output "Hibernation status is unknown for VM: $VMName"
}



Connect-AzAccount -Subscription RemoteDesktopDevices-EMEA-NEU-PRD
$VMs = Get-AzVM -ResourceGroupName rg-EUS-RemoteDesktopDevices-PersistentVirtualDesktop-NEU-PRD | Where-Object { $_.Name -match "SS|DV" } 

returns 

ResourceGroupName                                                    Name    Location           VmSize  OsType              NIC ProvisioningState Zone
-----------------                                                    ----    --------           ------  ------              --- ----------------- ----
rg-EUS-RemoteDesktopDevices-PersistentVirtualDesktop-NEU-PRD M01PSSPI0001 northeurope  Standard_D4s_v5 Windows M01PSSPI0001-nic         Succeeded     
rg-EUS-RemoteDesktopDevices-PersistentVirtualDesktop-NEU-PRD M01PSSPI0002 northeurope  Standard_D4s_v5 Windows M01PSSPI0002-nic         Succeeded     
rg-EUS-RemoteDesktopDevices-PersistentVirtualDesktop-NEU-PRD M01PSSPI0003 northeurope  Standard_D4s_v5 Windows M01PSSPI0003-nic         Succeeded     
rg-EUS-RemoteDesktopDevices-PersistentVirtualDesktop-NEU-PRD M01PSSPI0004 northeurope  Standard_D4s_v5 Windows M01PSSPI0004-nic         Succeeded     
rg-EUS-RemoteDesktopDevices-PersistentVirtualDesktop-NEU-PRD M01PSSPI0005 northeurope  Standard_D4s_v5 Windows M01PSSPI0005-nic         Succeeded     
rg-EUS-RemoteDesktopDevices-PersistentVirtualDesktop-NEU-PRD M01PSSPI0006 northeurope  Standard_D4s_v5 Windows M01PSSPI0006-nic         Succeeded     

I want to create a function that accepts Subscription and Resource Group, filters based on the match string $_.Name -match "SS|DV" and runs the following action for each VM returned

$RG
#Declare the virtual machine name in the $VM variable
$VM
Stop-AzVM -ResourceGroupName $RG -Name $VM
$vmdetails=get-azvm -Name $VM -ResourceGroupName $RG 
$diskname=$vmdetails.StorageProfile.OsDisk.name
$disk = Get-AzDisk -ResourceGroupName $RG -DiskName $diskname
$disk.SupportsHibernation = $True
Update-AzDisk -ResourceGroupName $RG -DiskName $diskname -Disk $disk
$vm= Get-AzVM -ResourceGroupName $RG -Name $VM
Update-AzVM -ResourceGroupName $RG -VM $VM -HibernationEnabled
