let Events = WVDConnections;
Events
| where TimeGenerated >= ago(30d)
| where State == "Connected"
| project CorrelationId, UserName, ResourceAlias, StartTime = TimeGenerated, PredecessorConnectionId
| join (
    Events
    | where State == "Completed"
    | project EndTime = TimeGenerated, CorrelationId, PredecessorConnectionId
) on CorrelationId
| project CorrelationId, StartTime, EndTime, UserName, 
          Duration = EndTime - StartTime, 
          DurationMinutes = (EndTime - StartTime) / 1min,
          DurationSeconds = tostring(round((EndTime - StartTime) / 1s, 0.1)),
          PredecessorConnectionId
| sort by Duration asc
