let ipPrefix = "10.";  // Set this to the desired IP prefix
Heartbeat
| where TimeGenerated >= ago(30d)
| summarize arg_max(TimeGenerated, *) by Computer
| extend FirstIPCandidate = tostring(split(tolower(tostring(ComputerPrivateIPs)), ",")[0])
| extend SecondIPCandidate = tostring(split(tolower(tostring(ComputerPrivateIPs)), ",")[1])
| extend IsFirstIPStartsWithPrefix = FirstIPCandidate has tolower(ipPrefix)
| extend PrivateIPAddressCandidate = iff(IsFirstIPStartsWithPrefix, FirstIPCandidate, SecondIPCandidate)
| extend PrivateIPAddress = replace(@'["\[\]]', '', PrivateIPAddressCandidate)
| project TimeGenerated, Computer, tostring(ComputerPrivateIPs), PrivateIPAddress
| distinct Computer, TimeGenerated, ComputerPrivateIPs, PrivateIPAddress
