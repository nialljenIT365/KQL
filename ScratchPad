let
    // WVDCOnnections KQL
    Source = AzureDataExplorer.Contents("https://ade.loganalytics.io/subscriptions/58cb357e-51af-4f62-8982-a8c2b9059362/resourcegroups/rg-eus-desktopmanagement-nerdio-weu-prd/providers/microsoft.operationalinsights/workspaces/nmw-app-law-fwjv4wn75m4qg", "nmw-app-law-fwjv4wn75m4qg", "let ipPrefix = ""10."";  // Set this to the desired IP prefix#(lf)Heartbeat#(lf)| where TimeGenerated >= ago(30d)#(lf)| summarize arg_max(TimeGenerated, *) by Computer#(lf)| extend FirstIPCandidate = tostring(split(tolower(tostring(ComputerPrivateIPs)), "","")[0])#(lf)| extend SecondIPCandidate = tostring(split(tolower(tostring(ComputerPrivateIPs)), "","")[1])#(lf)| extend IsFirstIPStartsWithPrefix = FirstIPCandidate has tolower(ipPrefix)#(lf)| extend PrivateIPAddressCandidate = iff(IsFirstIPStartsWithPrefix, FirstIPCandidate, SecondIPCandidate)#(lf)| extend PrivateIPAddress = replace(@'[""\[\]]', '', PrivateIPAddressCandidate)#(lf)| project Computer, tostring(ComputerPrivateIPs), PrivateIPAddress#(lf)| distinct Computer, ComputerPrivateIPs, PrivateIPAddress", [MaxRows=null, MaxSize=null, NoTruncate=null, AdditionalSetStatements=null])
in
    Source
